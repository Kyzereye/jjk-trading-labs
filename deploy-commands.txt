# JJK Trading Labs - VPS Deployment Commands
# Run these commands on your Hostinger VPS

# 1. Update system and install packages
sudo apt update && sudo apt upgrade -y
sudo apt install -y curl wget git nginx mysql-server nodejs npm certbot python3-certbot-nginx
sudo npm install -g pm2

# 2. Clone repository
cd /var/www
sudo git clone https://github.com/yourusername/jjktradinglabs.git
sudo chown -R $USER:$USER /var/www/jjktradinglabs

# 3. Setup database
sudo mysql_secure_installation
sudo mysql -u root -p
# In MySQL:
# CREATE DATABASE StockPxLabs;
# CREATE USER 'trading_user'@'localhost' IDENTIFIED BY 'your_secure_password';
# GRANT ALL PRIVILEGES ON StockPxLabs.* TO 'trading_user'@'localhost';
# FLUSH PRIVILEGES;
# EXIT;

# 4. Setup backend
cd /var/www/jjktradinglabs/backend
npm install --production
cp ../production.env .env
# Edit .env with your production values
nano .env

# 5. Setup frontend
cd /var/www/jjktradinglabs/frontend
npm install
npm run build:prod

# 6. Initialize database
cd /var/www/jjktradinglabs/backend
mysql -u root -p StockPxLabs < sql_queries.sql

# 7. Configure Nginx
sudo cp /var/www/jjktradinglabs/nginx.conf /etc/nginx/sites-available/jjktradinglabs
sudo ln -s /etc/nginx/sites-available/jjktradinglabs /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl reload nginx

# 8. Start backend with PM2
cd /var/www/jjktradinglabs/backend
pm2 start pm2.config.js
pm2 save
pm2 startup

# 9. Setup SSL
sudo certbot --nginx -d jjktradinglabs.com -d www.jjktradinglabs.com -d api.jjktradinglabs.com

# 10. Check everything is working
pm2 status
sudo systemctl status nginx
curl https://jjktradinglabs.com
curl https://api.jjktradinglabs.com/api/health
